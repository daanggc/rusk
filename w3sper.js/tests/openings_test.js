// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.
//
// Copyright (c) DUSK NETWORK. All rights reserved.

import { test, assert } from "./harness.js";
import * as ProtocolDriver from "../src/protocol-driver/mod.js";

test.withLocalWasm = "release";

test("openings", async () => {
  const bytes = new Uint8Array([
    1, 0, 0, 0, 0, 0, 0, 0, 201, 102, 172, 58, 141, 139, 72, 111, 124, 215, 250,
    25, 3, 246, 120, 158, 255, 10, 65, 223, 76, 17, 100, 115, 97, 148, 239, 131,
    221, 84, 100, 29, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 44, 251, 236, 190, 42, 207, 97, 113, 192, 139, 66, 166, 228, 216, 13,
    133, 101, 190, 54, 4, 27, 219, 189, 103, 82, 128, 104, 152, 236, 140, 200,
    79, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 50, 179,
    15, 91, 11, 61, 164, 102, 175, 72, 71, 233, 78, 78, 82, 84, 181, 173, 90,
    88, 167, 203, 13, 78, 52, 18, 148, 50, 137, 61, 19, 39, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 12, 25, 2, 120, 119, 19, 48, 239,
    61, 192, 209, 164, 237, 8, 223, 217, 98, 170, 121, 240, 124, 56, 248, 124,
    0, 219, 34, 125, 137, 87, 43, 93, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 77, 209, 57, 213, 157, 92, 179, 250, 75, 86, 240, 81,
    150, 31, 36, 240, 115, 240, 92, 46, 144, 110, 186, 20, 226, 100, 90, 109,
    26, 37, 58, 65, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 201, 207, 216, 214, 227, 33, 206, 85, 5, 120, 183, 72, 162, 24, 253, 41,
    67, 165, 117, 195, 181, 235, 40, 17, 4, 48, 157, 115, 54, 85, 200, 67, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 116, 53, 86, 71,
    118, 232, 113, 15, 66, 108, 49, 100, 144, 187, 78, 126, 8, 41, 133, 167, 56,
    37, 191, 72, 174, 157, 25, 7, 243, 207, 157, 24, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 136, 38, 205, 228, 207, 250, 118, 81,
    145, 131, 122, 181, 103, 64, 127, 205, 137, 156, 200, 105, 228, 243, 98, 17,
    31, 158, 172, 182, 102, 170, 40, 80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 13, 238, 216, 44, 119, 177, 210, 37, 32, 165, 189,
    231, 208, 248, 161, 61, 156, 220, 188, 131, 250, 2, 17, 62, 248, 95, 67, 16,
    43, 11, 251, 80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 48, 31, 34, 86, 186, 245, 161, 183, 9, 106, 200, 207, 255, 125, 27, 154,
    229, 87, 197, 198, 55, 171, 168, 116, 68, 5, 253, 93, 146, 136, 199, 13, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 249, 129, 249,
    8, 65, 187, 167, 161, 77, 50, 247, 41, 245, 129, 56, 234, 1, 197, 52, 23,
    45, 131, 253, 76, 26, 214, 0, 206, 115, 172, 148, 82, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 82, 22, 131, 131, 101, 7, 177, 5,
    102, 18, 111, 232, 7, 215, 150, 164, 29, 97, 92, 93, 172, 170, 20, 108, 181,
    184, 119, 39, 255, 93, 31, 57, 234, 25, 144, 4, 87, 109, 230, 24, 74, 121,
    223, 164, 29, 63, 246, 170, 91, 59, 251, 78, 233, 109, 122, 129, 186, 207,
    23, 213, 133, 10, 160, 32, 116, 230, 210, 116, 78, 140, 82, 238, 100, 243,
    97, 60, 5, 156, 153, 94, 32, 190, 225, 182, 8, 34, 61, 100, 140, 233, 154,
    48, 21, 237, 111, 19, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 226, 235, 11, 250, 220, 50, 150,
    251, 158, 61, 252, 169, 58, 146, 53, 138, 49, 166, 102, 245, 42, 222, 139,
    152, 184, 208, 200, 98, 193, 35, 48, 84, 45, 140, 193, 60, 178, 135, 134,
    132, 91, 65, 176, 180, 88, 17, 71, 29, 2, 95, 84, 40, 140, 129, 56, 168, 56,
    66, 122, 170, 24, 95, 98, 25, 130, 55, 72, 181, 83, 232, 204, 41, 201, 131,
    143, 150, 30, 169, 188, 99, 26, 80, 175, 29, 17, 76, 100, 55, 134, 68, 177,
    54, 163, 193, 85, 115, 119, 94, 24, 225, 154, 139, 6, 255, 75, 43, 60, 116,
    236, 145, 58, 235, 117, 11, 176, 168, 182, 202, 125, 253, 186, 49, 77, 249,
    32, 205, 142, 87, 29, 169, 29, 161, 227, 106, 44, 186, 3, 134, 125, 146,
    241, 187, 161, 46, 22, 95, 58, 156, 85, 183, 19, 125, 22, 70, 94, 2, 209,
    91, 47, 48, 218, 199, 75, 136, 54, 67, 159, 55, 115, 241, 231, 26, 60, 6,
    212, 129, 255, 148, 81, 124, 212, 253, 43, 168, 36, 23, 21, 236, 148, 17,
    155, 26, 249, 87, 27, 33, 30, 140, 139, 30, 33, 245, 16, 183, 27, 203, 227,
    13, 170, 30, 76, 60, 120, 22, 187, 98, 28, 247, 124, 192, 101, 26, 107, 84,
    196, 34, 145, 142, 67, 44, 106, 85, 230, 3, 82, 46, 199, 162, 57, 246, 92,
    19, 75, 40, 164, 193, 147, 214, 96, 46, 4, 74, 202, 154, 13, 66, 0, 214, 12,
    91, 195, 20, 191, 100, 180, 239, 26, 173, 26, 92, 24, 209, 49, 127, 25, 236,
    91, 189, 19, 214, 38, 83, 43, 186, 252, 249, 42, 5, 179, 7, 247, 90, 188,
    244, 117, 87, 180, 153, 224, 55, 134, 139, 198, 247, 109, 21, 2, 72, 133,
    21, 142, 97, 15, 102, 18, 180, 239, 218, 165, 104, 17, 210, 25, 26, 223,
    231, 229, 145, 241, 197, 206, 10, 231, 241, 148, 39, 106, 30, 168, 250, 45,
    216, 43, 99, 41, 212, 69, 208, 140, 216, 169, 103, 49, 111, 160, 33, 239,
    43, 160, 155, 21, 190, 40, 174, 248, 190, 39, 145, 203, 109, 181, 53, 37,
    229, 145, 107, 174, 4, 190, 114, 224, 127, 169, 88, 221, 73, 133, 75, 20,
    16, 221, 13, 184, 71, 237, 249, 4, 153, 220, 208, 57, 195, 158, 186, 50,
    250, 218, 104, 89, 241, 19, 125, 194, 127, 85, 112, 105, 99, 55, 101, 58,
    158, 66, 172, 188, 131, 209, 37, 40, 172, 213, 253, 217, 33, 100, 132, 103,
    119, 245, 102, 232, 40, 47, 175, 47, 255, 137, 2, 222, 225, 165, 67, 48,
    137, 188, 149, 247, 241, 110, 32, 64, 160, 40, 154, 118, 26, 66, 167, 128,
    248, 5, 149, 191, 84, 219, 65, 31, 193, 124, 12, 31, 18, 221, 171, 158, 129,
    54, 171, 169, 206, 255, 35, 241, 117, 1, 140, 221, 2, 98, 80, 19, 166, 213,
    83, 152, 186, 242, 1, 60, 193, 65, 22, 228, 148, 28, 69, 223, 186, 174, 154,
    107, 1, 208, 223, 80, 2, 252, 215, 109, 239, 248, 53, 115, 151, 129, 12,
    153, 61, 6, 31, 232, 245, 242, 25, 119, 114, 76, 89, 89, 220, 101, 145, 97,
    114, 177, 219, 3, 175, 193, 230, 133, 147, 164, 98, 190, 31, 73, 126, 181,
    60, 174, 154, 12, 34, 202, 40, 206, 51, 234, 175, 150, 178, 207, 183, 190,
    135, 159, 134, 183, 166, 249, 223, 232, 24, 44, 199, 242, 45, 24, 88, 134,
    144, 28, 174, 241, 228, 84, 2, 15, 200, 88, 25, 21, 215, 82, 117, 109, 63,
    37, 241, 53, 254, 252, 4, 210, 122, 217, 149, 253, 108, 65, 41, 173, 231,
    250, 177, 37, 201, 225, 4, 121, 69, 108, 88, 195, 29, 50, 16, 125, 153, 5,
    175, 180, 242, 181, 127, 37, 74, 250, 155, 6, 162, 204, 38, 76, 148, 130,
    190, 220, 119, 98, 38, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 3, 0, 0, 0, 3, 0, 0, 0, 2, 0, 0, 0, 3, 0, 0, 0, 1, 0, 0, 0,
    0, 0, 0, 0,
  ]);

  // await ProtocolDriver.opening([bytes, bytes, bytes, bytes]);
  await ProtocolDriver.opening([bytes, bytes, bytes, bytes]);

  // const TRANSFER =
  //   "0100000000000000000000000000000000000000000000000000000000000000";

  // const url = new URL(`/on/contracts:${TRANSFER}/root`, network.url);

  // const req = new Request(url, {
  //   headers: { "Content-Type": "application/octet-stream" },
  //   method: "POST",
  // });

  // const response = await network.dispatch(req);
  // const buffer = await response.arrayBuffer();
  // const root = new Uint8Array(await buffer);
  // console.log(root);

  // await ProtocolDriver.root(root);

  // return;
});
